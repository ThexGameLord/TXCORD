name: API

on:
  push:
    branches: [ "API" ]
  pull_request:
    branches: [ "API" ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Set up Python 3.10
      uses: actions/setup-python@v3
      with:
        python-version: "3.10"
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests
        pip install configparser
        pip install bump2version  # Add bump2version installation
    - name: Bump version and commit
      run: |
        bump2version patch --config-file bumpversion.cfg
        git add txcordapi.py
        git commit -m "Bump version"
        git push origin API
      env:
        GIT_EMAIL: ${{ secrets.GIT_EMAIL }}
        GIT_USERNAME: ${{ secrets.GIT_USERNAME }}
        pythonLocation: /opt/hostedtoolcache/Python/3.10.12/x64
        LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.10.12/x64/lib

    - name: Test API
      run: |
        pytest txcordapi.py
