name: Release on API Change

on:
  push:
    branches:
      - API

jobs:
  release:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Set up Python 3.10
      uses: actions/setup-python@v3
      with:
        python-version: "3.10"
    - name: Install bump2version
      run: pip install bump2version
    - name: Bump Version
      run: |
        bump2version patch --config-file bumpversion.cfg
        git add txcordapi.py
        git commit -m "Bump version"
        git push origin API
    - name: Install dependencies and build
      run: |
        pip install requests
        pip install configparser
        pip install pyinstaller  # Or cx_Freeze, depending on your choice
        pyinstaller --onefile txcordapi.py  # Replace with the correct command for your tool
    - name: Create Release
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        # Extract the new version from txcordapi.py
        NEW_VERSION=$(grep -oP '(?<=__version__ = ")[^"]+' txcordapi.py)
        echo "New version: $NEW_VERSION"
        # Create a new GitHub release using the GitHub API
        git tag $NEW_VERSION
        git push origin $NEW_VERSION
        echo "Creating GitHub release..."
        gh release create $NEW_VERSION ./dist/txcordapi  # Replace 'gh' with 'gh.exe' if using Windows
